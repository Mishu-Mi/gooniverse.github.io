var VAST=function(e){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,i=c(e);if(t){var a=c(this).constructor;r=Reflect.construct(i,arguments,a)}else r=i.apply(this,arguments);return function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}(this,r)}}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,adId:e.adId||null,sequence:e.sequence||null,apiFramework:e.apiFramework||null,universalAdId:{value:null,idRegistry:"unknown"},creativeExtensions:[]}}var h=["ADCATEGORIES","ADCOUNT","ADPLAYHEAD","ADSERVINGID","ADTYPE","APIFRAMEWORKS","APPBUNDLE","ASSETURI","BLOCKEDADCATEGORIES","BREAKMAXADLENGTH","BREAKMAXADS","BREAKMAXDURATION","BREAKMINADLENGTH","BREAKMINDURATION","BREAKPOSITION","CLICKPOS","CLICKTYPE","CLIENTUA","CONTENTID","CONTENTPLAYHEAD","CONTENTURI","DEVICEIP","DEVICEUA","DOMAIN","EXTENSIONS","GDPRCONSENT","IFA","IFATYPE","INVENTORYSTATE","LATLONG","LIMITADTRACKING","MEDIAMIME","MEDIAPLAYHEAD","OMIDPARTNER","PAGEURL","PLACEMENTTYPE","PLAYERCAPABILITIES","PLAYERSIZE","PLAYERSTATE","PODSEQUENCE","REGULATIONS","SERVERSIDE","SERVERUA","TRANSACTIONID","UNIVERSALADID","VASTVERSIONS","VERIFICATIONVENDORS"];function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[],a=g(e);for(var n in!t.ERRORCODE||r.isCustomCode||/^[0-9]{3}$/.test(t.ERRORCODE)||(t.ERRORCODE=900),t.CACHEBUSTING=A(Math.round(1e8*Math.random()).toString()),t.TIMESTAMP=(new Date).toISOString(),t.RANDOM=t.random=t.CACHEBUSTING,t)t[n]=k(t[n]);for(var o in a){var s=a[o];"string"==typeof s&&i.push(m(s,t))}return i}function m(e,t){var r=(e=f(e,t)).match(/[^[\]]+(?=])/g);if(!r)return e;var i=r.filter((function(e){return h.indexOf(e)>-1}));return 0===i.length?e:f(e,i=i.reduce((function(e,t){return e[t]=-1,e}),{}))}function f(e,t){var r=e;for(var i in t){var a=t[i];r=r.replace(new RegExp("(?:\\[|%%)(".concat(i,")(?:\\]|%%)"),"g"),a)}return r}function g(e){return Array.isArray(e)?e.map((function(e){return e&&e.hasOwnProperty("url")?e.url:e})):e}function T(e,t){for(var r=0;r<t.length;r++)if(y(t[r],e))return!0;return!1}function y(e,t){if(e&&t){var r=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(t);return r.length===i.length&&e.id===t.id&&e.url===t.url}return!1}function k(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%".concat(e.charCodeAt(0).toString(16))}))}function A(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,r=String(e);return r.length<t?R(0,t-r.length,!1).map((function(){return"0"})).join("")+r:r}function R(e,t,r){for(var i=[],a=e<t,n=r?a?t+1:t-1:t,o=e;a?o<n:o>n;a?o++:o--)i.push(o);return i}var w={track:function(e,t,r){v(e,t,r).forEach((function(e){"undefined"!=typeof window&&null!==window&&((new Image).src=e)}))},resolveURLTemplates:v,extractURLsFromTemplates:g,containsTemplateObject:T,isTemplateObjectEqual:y,encodeURIComponentRFC3986:k,replaceUrlMacros:m,leftpad:A,range:R,isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},flatten:function e(t){return t.reduce((function(t,r){return t.concat(Array.isArray(r)?e(r):r)}),[])},joinArrayOfUniqueTemplateObjs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=Array.isArray(e)?e:[],i=Array.isArray(t)?t:[];return r.concat(i).reduce((function(e,t){return T(t,e)||e.push(t),e}),[])}};function b(e){return-1!==["true","TRUE","True","1"].indexOf(e)}var E={childByName:function(e,t){var r=e.childNodes;for(var i in r){var a=r[i];if(a.nodeName===t)return a}},childrenByName:function(e,t){var r=[],i=e.childNodes;for(var a in i){var n=i[a];n.nodeName===t&&r.push(n)}return r},resolveVastAdTagURI:function(e,t){if(!t)return e;if(0===e.indexOf("//")){var r=location.protocol;return"".concat(r).concat(e)}if(-1===e.indexOf("://")){var i=t.slice(0,t.lastIndexOf("/"));return"".concat(i,"/").concat(e)}return e},parseBoolean:b,parseNodeText:function(e){return e&&(e.textContent||e.text||"").trim()},copyNodeAttribute:function(e,t,r){var i=t.getAttribute(e);i&&r.setAttribute(e,i)},parseAttributes:function(e){for(var t=e.attributes,r={},i=0;i<t.length;i++)r[t[i].nodeName]=t[i].nodeValue;return r},parseDuration:function(e){if(null==e)return-1;if(w.isNumeric(e))return parseInt(e);var t=e.split(":");if(3!==t.length)return-1;var r=t[2].split("."),i=parseInt(r[0]);2===r.length&&(i+=parseFloat("0.".concat(r[1])));var a=parseInt(60*t[1]),n=parseInt(60*t[0]*60);return isNaN(n)||isNaN(a)||isNaN(i)||a>3600||i>60?-1:n+a+i},splitVAST:function(e){var t=[],r=null;return e.forEach((function(i,a){if(i.sequence&&(i.sequence=parseInt(i.sequence,10)),i.sequence>1){var n=e[a-1];if(n&&n.sequence===i.sequence-1)return void(r&&r.push(i));delete i.sequence}r=[i],t.push(r)})),t},assignAttributes:function(e,t){if(e)for(var r in e){var i=e[r];if(i.nodeName&&i.nodeValue&&t.hasOwnProperty(i.nodeName)){var a=i.nodeValue;"boolean"==typeof t[i.nodeName]&&(a=b(a)),t[i.nodeName]=a}}},mergeWrapperAdData:function(e,t){e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),e.followAdditionalWrappers=t.followAdditionalWrappers,e.allowMultipleAds=t.allowMultipleAds,e.fallbackOnNoAd=t.fallbackOnNoAd;var r=(t.creatives||[]).filter((function(e){return e&&"companion"===e.type})),i=r.reduce((function(e,t){return(t.variations||[]).forEach((function(t){(t.companionClickTrackingURLTemplates||[]).forEach((function(t){w.containsTemplateObject(t,e)||e.push(t)}))})),e}),[]);e.creatives=r.concat(e.creatives);var a=t.videoClickTrackingURLTemplates&&t.videoClickTrackingURLTemplates.length,n=t.videoCustomClickURLTemplates&&t.videoCustomClickURLTemplates.length;e.creatives.forEach((function(e){if(t.trackingEvents&&t.trackingEvents[e.type])for(var r in t.trackingEvents[e.type]){var o=t.trackingEvents[e.type][r];Array.isArray(e.trackingEvents[r])||(e.trackingEvents[r]=[]),e.trackingEvents[r]=e.trackingEvents[r].concat(o)}"linear"===e.type&&(a&&(e.videoClickTrackingURLTemplates=e.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates)),n&&(e.videoCustomClickURLTemplates=e.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates)),!t.videoClickThroughURLTemplate||null!==e.videoClickThroughURLTemplate&&void 0!==e.videoClickThroughURLTemplate||(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate)),"companion"===e.type&&i.length&&(e.variations||[]).forEach((function(e){e.companionClickTrackingURLTemplates=w.joinArrayOfUniqueTemplateObjs(e.companionClickTrackingURLTemplates,i)}))})),t.adVerifications&&(e.adVerifications=e.adVerifications.concat(t.adVerifications)),t.blockedAdCategories&&(e.blockedAdCategories=e.blockedAdCategories.concat(t.blockedAdCategories))}};function N(e,t){var r=function(){var e=p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:e.id,adId:e.adId,sequence:e.sequence,apiFramework:e.apiFramework,type:"companion",required:null,variations:[]}}(t);return r.required=e.getAttribute("required")||null,r.variations=E.childrenByName(e,"Companion").map((function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,adType:"companionAd",width:e.width||0,height:e.height||0,assetWidth:e.assetWidth||null,assetHeight:e.assetHeight||null,expandedWidth:e.expandedWidth||null,expandedHeight:e.expandedHeight||null,apiFramework:e.apiFramework||null,adSlotID:e.adSlotID||null,pxratio:e.pxratio||"1",renderingMode:e.renderingMode||"default",staticResources:[],htmlResources:[],iframeResources:[],adParameters:null,xmlEncoded:null,altText:null,companionClickThroughURLTemplate:null,companionClickTrackingURLTemplates:[],trackingEvents:{}}}(E.parseAttributes(e));t.htmlResources=E.childrenByName(e,"HTMLResource").reduce((function(e,t){var r=E.parseNodeText(t);return r?e.concat(r):e}),[]),t.iframeResources=E.childrenByName(e,"IFrameResource").reduce((function(e,t){var r=E.parseNodeText(t);return r?e.concat(r):e}),[]),t.staticResources=E.childrenByName(e,"StaticResource").reduce((function(e,t){var r=E.parseNodeText(t);return r?e.concat({url:r,creativeType:t.getAttribute("creativeType")||null}):e}),[]),t.altText=E.parseNodeText(E.childByName(e,"AltText"))||null;var r=E.childByName(e,"TrackingEvents");r&&E.childrenByName(r,"Tracking").forEach((function(e){var r=e.getAttribute("event"),i=E.parseNodeText(e);r&&i&&(Array.isArray(t.trackingEvents[r])||(t.trackingEvents[r]=[]),t.trackingEvents[r].push(i))})),t.companionClickTrackingURLTemplates=E.childrenByName(e,"CompanionClickTracking").map((function(e){return{id:e.getAttribute("id")||null,url:E.parseNodeText(e)}})),t.companionClickThroughURLTemplate=E.parseNodeText(E.childByName(e,"CompanionClickThrough"))||null;var i=E.childByName(e,"AdParameters");return i&&(t.adParameters=E.parseNodeText(i),t.xmlEncoded=i.getAttribute("xmlEncoded")||null),t})),r}function L(e,t){var r,i=function(){var e=p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:e.id,adId:e.adId,sequence:e.sequence,apiFramework:e.apiFramework,type:"linear",duration:0,skipDelay:null,mediaFiles:[],mezzanine:null,interactiveCreativeFile:null,closedCaptionFiles:[],videoClickThroughURLTemplate:null,videoClickTrackingURLTemplates:[],videoCustomClickURLTemplates:[],adParameters:null,icons:[],trackingEvents:{}}}(t);i.duration=E.parseDuration(E.parseNodeText(E.childByName(e,"Duration")));var a=e.getAttribute("skipoffset");if(null==a)i.skipDelay=null;else if("%"===a.charAt(a.length-1)&&-1!==i.duration){var n=parseInt(a,10);i.skipDelay=i.duration*(n/100)}else i.skipDelay=E.parseDuration(a);var o=E.childByName(e,"VideoClicks");if(o){var s=E.childByName(o,"ClickThrough");i.videoClickThroughURLTemplate=s?{id:s.getAttribute("id")||null,url:E.parseNodeText(s)}:null,E.childrenByName(o,"ClickTracking").forEach((function(e){i.videoClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:E.parseNodeText(e)})})),E.childrenByName(o,"CustomClick").forEach((function(e){i.videoCustomClickURLTemplates.push({id:e.getAttribute("id")||null,url:E.parseNodeText(e)})}))}var l=E.childByName(e,"AdParameters");l&&(i.adParameters=E.parseNodeText(l)),E.childrenByName(e,"TrackingEvents").forEach((function(e){E.childrenByName(e,"Tracking").forEach((function(e){var t=e.getAttribute("event"),a=E.parseNodeText(e);if(t&&a){if("progress"===t){if(!(r=e.getAttribute("offset")))return;t="%"===r.charAt(r.length-1)?"progress-".concat(r):"progress-".concat(Math.round(E.parseDuration(r)))}Array.isArray(i.trackingEvents[t])||(i.trackingEvents[t]=[]),i.trackingEvents[t].push(a)}}))})),E.childrenByName(e,"MediaFiles").forEach((function(e){E.childrenByName(e,"MediaFile").forEach((function(e){i.mediaFiles.push(function(e){var t={id:null,fileURL:null,fileSize:0,deliveryType:"progressive",mimeType:null,mediaType:null,codec:null,bitrate:0,minBitrate:0,maxBitrate:0,width:0,height:0,apiFramework:null,scalable:null,maintainAspectRatio:null};t.id=e.getAttribute("id"),t.fileURL=E.parseNodeText(e),t.deliveryType=e.getAttribute("delivery"),t.codec=e.getAttribute("codec"),t.mimeType=e.getAttribute("type"),t.mediaType=e.getAttribute("mediaType")||"2D",t.apiFramework=e.getAttribute("apiFramework"),t.fileSize=parseInt(e.getAttribute("fileSize")||0),t.bitrate=parseInt(e.getAttribute("bitrate")||0),t.minBitrate=parseInt(e.getAttribute("minBitrate")||0),t.maxBitrate=parseInt(e.getAttribute("maxBitrate")||0),t.width=parseInt(e.getAttribute("width")||0),t.height=parseInt(e.getAttribute("height")||0);var r=e.getAttribute("scalable");r&&"string"==typeof r&&(t.scalable=E.parseBoolean(r));var i=e.getAttribute("maintainAspectRatio");return i&&"string"==typeof i&&(t.maintainAspectRatio=E.parseBoolean(i)),t}(e))}));var t=E.childByName(e,"InteractiveCreativeFile");t&&(i.interactiveCreativeFile=function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:e.type||null,apiFramework:e.apiFramework||null,variableDuration:E.parseBoolean(e.variableDuration),fileURL:null}}(E.parseAttributes(e));return t.fileURL=E.parseNodeText(e),t}(t));var r=E.childByName(e,"ClosedCaptionFiles");r&&E.childrenByName(r,"ClosedCaptionFile").forEach((function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:e.type||null,language:e.language||null,fileURL:null}}(E.parseAttributes(e));t.fileURL=E.parseNodeText(e),i.closedCaptionFiles.push(t)}));var a,n,o,s=E.childByName(e,"Mezzanine"),l=(a=s,n={},o=!1,["delivery","type","width","height"].forEach((function(e){a&&a.getAttribute(e)?n[e]=a.getAttribute(e):o=!0})),o?null:n);if(l){var c={id:null,fileURL:null,delivery:null,codec:null,type:null,width:0,height:0,fileSize:0,mediaType:"2D"};c.id=s.getAttribute("id"),c.fileURL=E.parseNodeText(s),c.delivery=l.delivery,c.codec=s.getAttribute("codec"),c.type=l.type,c.width=parseInt(l.width,10),c.height=parseInt(l.height,10),c.fileSize=parseInt(s.getAttribute("fileSize"),10),c.mediaType=s.getAttribute("mediaType")||"2D",i.mezzanine=c}}));var c=E.childByName(e,"Icons");return c&&E.childrenByName(c,"Icon").forEach((function(e){i.icons.push(function(e){var t={program:null,height:0,width:0,xPosition:0,yPosition:0,apiFramework:null,offset:null,duration:0,type:null,staticResource:null,htmlResource:null,iframeResource:null,pxratio:"1",iconClickThroughURLTemplate:null,iconClickTrackingURLTemplates:[],iconViewTrackingURLTemplate:null};t.program=e.getAttribute("program"),t.height=parseInt(e.getAttribute("height")||0),t.width=parseInt(e.getAttribute("width")||0),t.xPosition=function(e){return-1!==["left","right"].indexOf(e)?e:parseInt(e||0)}(e.getAttribute("xPosition")),t.yPosition=function(e){return-1!==["top","bottom"].indexOf(e)?e:parseInt(e||0)}(e.getAttribute("yPosition")),t.apiFramework=e.getAttribute("apiFramework"),t.pxratio=e.getAttribute("pxratio")||"1",t.offset=E.parseDuration(e.getAttribute("offset")),t.duration=E.parseDuration(e.getAttribute("duration")),E.childrenByName(e,"HTMLResource").forEach((function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=E.parseNodeText(e)})),E.childrenByName(e,"IFrameResource").forEach((function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=E.parseNodeText(e)})),E.childrenByName(e,"StaticResource").forEach((function(e){t.type=e.getAttribute("creativeType")||0,t.staticResource=E.parseNodeText(e)}));var r=E.childByName(e,"IconClicks");return r&&(t.iconClickThroughURLTemplate=E.parseNodeText(E.childByName(r,"IconClickThrough")),E.childrenByName(r,"IconClickTracking").forEach((function(e){t.iconClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:E.parseNodeText(e)})}))),t.iconViewTrackingURLTemplate=E.parseNodeText(E.childByName(e,"IconViewTracking")),t}(e))})),i}function C(e,t){var r=function(){var e=p(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:e.id,adId:e.adId,sequence:e.sequence,apiFramework:e.apiFramework,type:"nonlinear",variations:[],trackingEvents:{}}}(t);return E.childrenByName(e,"TrackingEvents").forEach((function(e){var t,i;E.childrenByName(e,"Tracking").forEach((function(e){t=e.getAttribute("event"),i=E.parseNodeText(e),t&&i&&(Array.isArray(r.trackingEvents[t])||(r.trackingEvents[t]=[]),r.trackingEvents[t].push(i))}))})),E.childrenByName(e,"NonLinear").forEach((function(e){var t={id:null,width:0,height:0,expandedWidth:0,expandedHeight:0,scalable:!0,maintainAspectRatio:!0,minSuggestedDuration:0,apiFramework:"static",adType:"nonLinearAd",type:null,staticResource:null,htmlResource:null,iframeResource:null,nonlinearClickThroughURLTemplate:null,nonlinearClickTrackingURLTemplates:[],adParameters:null};t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.expandedWidth=e.getAttribute("expandedWidth"),t.expandedHeight=e.getAttribute("expandedHeight"),t.scalable=E.parseBoolean(e.getAttribute("scalable")),t.maintainAspectRatio=E.parseBoolean(e.getAttribute("maintainAspectRatio")),t.minSuggestedDuration=E.parseDuration(e.getAttribute("minSuggestedDuration")),t.apiFramework=e.getAttribute("apiFramework"),E.childrenByName(e,"HTMLResource").forEach((function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=E.parseNodeText(e)})),E.childrenByName(e,"IFrameResource").forEach((function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=E.parseNodeText(e)})),E.childrenByName(e,"StaticResource").forEach((function(e){t.type=e.getAttribute("creativeType")||0,t.staticResource=E.parseNodeText(e)}));var i=E.childByName(e,"AdParameters");i&&(t.adParameters=E.parseNodeText(i)),t.nonlinearClickThroughURLTemplate=E.parseNodeText(E.childByName(e,"NonLinearClickThrough")),E.childrenByName(e,"NonLinearClickTracking").forEach((function(e){t.nonlinearClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:E.parseNodeText(e)})})),r.variations.push(t)})),r}function _(e){var t=[];return e.forEach((function(e){var r=U(e);r&&t.push(r)})),t}function U(e){if("#comment"===e.nodeName)return null;var t,r={name:null,value:null,attributes:{},children:[]},i=e.attributes,a=e.childNodes;if(r.name=e.nodeName,e.attributes)for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];o.nodeName&&o.nodeValue&&(r.attributes[o.nodeName]=o.nodeValue)}for(var s in a)if(a.hasOwnProperty(s)){var l=U(a[s]);l&&r.children.push(l)}if(0===r.children.length||1===r.children.length&&["#cdata-section","#text"].indexOf(r.children[0].name)>=0){var c=E.parseNodeText(e);""!==c&&(r.value=c),r.children=[]}return null===(t=r).value&&0===Object.keys(t.attributes).length&&0===t.children.length?null:r}function I(e){var t=[];return e.forEach((function(e){var r,i,a={id:e.getAttribute("id")||null,adId:x(e),sequence:e.getAttribute("sequence")||null,apiFramework:e.getAttribute("apiFramework")||null},n=E.childByName(e,"UniversalAdId");n&&(r={idRegistry:n.getAttribute("idRegistry")||"unknown",value:E.parseNodeText(n)});var o=E.childByName(e,"CreativeExtensions");for(var s in o&&(i=_(E.childrenByName(o,"CreativeExtension"))),e.childNodes){var l=e.childNodes[s],c=void 0;switch(l.nodeName){case"Linear":c=L(l,a);break;case"NonLinearAds":c=C(l,a);break;case"CompanionAds":c=N(l,a)}c&&(r&&(c.universalAdId=r),i&&(c.creativeExtensions=i),t.push(c))}})),t}function x(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null}var S={Wrapper:{subElements:["VASTAdTagURI","Impression"]},BlockedAdCategories:{attributes:["authority"]},InLine:{subElements:["AdSystem","AdTitle","Impression","AdServingId","Creatives"]},Category:{attributes:["authority"]},Pricing:{attributes:["model","currency"]},Verification:{oneOfinLineResources:["JavaScriptResource","ExecutableResource"],attributes:["vendor"]},UniversalAdId:{attributes:["idRegistry"]},JavaScriptResource:{attributes:["apiFramework","browserOptional"]},ExecutableResource:{attributes:["apiFramework","type"]},Tracking:{attributes:["event"]},Creatives:{subElements:["Creative"]},Creative:{subElements:["UniversalAdId"]},Linear:{subElements:["MediaFiles","Duration"]},MediaFiles:{subElements:["MediaFile"]},MediaFile:{attributes:["delivery","type","width","height"]},Mezzanine:{attributes:["delivery","type","width","height"]},NonLinear:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"],attributes:["width","height"]},Companion:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"],attributes:["width","height"]},StaticResource:{attributes:["creativeType"]},Icons:{subElements:["Icon"]},Icon:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"]}};function D(e,t){var r=e.name,i=e.parentName,a=e.attributes,n=e.subElements,o=e.oneOfResources,s="Element '".concat(r,"'");t("VAST-warning",{message:s+=a?" missing required attribute(s) '".concat(a.join(", "),"' "):n?" missing required sub element(s) '".concat(n.join(", "),"' "):o?" must provide one of the following '".concat(o.join(", "),"' "):" is empty",parentElement:i,specVersion:4.1})}var O=function e(t,r,i){if(t&&t.nodeName)if("InLine"===t.nodeName&&(i=!0),function(e,t){if(S[e.nodeName]&&S[e.nodeName].attributes){var r=S[e.nodeName].attributes.filter((function(t){return!e.getAttribute(t)}));r.length>0&&D({name:e.nodeName,parentName:e.parentNode.nodeName,attributes:r},t)}}(t,r),function(e){return e.children&&0!==e.children.length}(t)){!function(e,t,r){var i=S[e.nodeName],a=!r&&"Wrapper"!==e.nodeName;if(i&&!a){if(i.subElements){var n=i.subElements.filter((function(t){return!E.childByName(e,t)}));n.length>0&&D({name:e.nodeName,parentName:e.parentNode.nodeName,subElements:n},t)}r&&i.oneOfinLineResources&&(i.oneOfinLineResources.some((function(t){return E.childByName(e,t)}))||D({name:e.nodeName,parentName:e.parentNode.nodeName,oneOfResources:i.oneOfinLineResources},t))}}(t,r,i);for(var a=0;a<t.children.length;a++)e(t.children[a],r,i)}else 0===E.parseNodeText(t).length&&D({name:t.nodeName,parentName:t.parentNode.nodeName},r)};function V(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.allowMultipleAds,a=r.followAdditionalWrappers,n=e.childNodes;for(var o in n){var s=n[o];if(-1!==["Wrapper","InLine"].indexOf(s.nodeName)&&("Wrapper"!==s.nodeName||!1!==a)){if(E.copyNodeAttribute("id",e,s),E.copyNodeAttribute("sequence",e,s),E.copyNodeAttribute("adType",e,s),"Wrapper"===s.nodeName)return{ad:F(s,t),type:"WRAPPER"};if("InLine"===s.nodeName)return{ad:P(s,t,{allowMultipleAds:i}),type:"INLINE"}}}}function P(e,t){return!1===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowMultipleAds&&e.getAttribute("sequence")?null:B(e,t)}function B(e,t){var r=[];t&&O(e,t);var i=e.childNodes,a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,sequence:e.sequence||null,adType:e.adType||null,adServingId:null,categories:[],expires:null,viewableImpression:{},system:null,title:null,description:null,advertiser:null,pricing:null,survey:null,errorURLTemplates:[],impressionURLTemplates:[],creatives:[],extensions:[],adVerifications:[],blockedAdCategories:[],followAdditionalWrappers:!0,allowMultipleAds:!1,fallbackOnNoAd:null}}(E.parseAttributes(e));for(var n in i){var o=i[n];switch(o.nodeName){case"Error":a.errorURLTemplates.push(E.parseNodeText(o));break;case"Impression":a.impressionURLTemplates.push({id:o.getAttribute("id")||null,url:E.parseNodeText(o)});break;case"Creatives":a.creatives=I(E.childrenByName(o,"Creative"));break;case"Extensions":var s=E.childrenByName(o,"Extension");a.extensions=_(s),a.adVerifications.length||(r=W(s));break;case"AdVerifications":a.adVerifications=M(E.childrenByName(o,"Verification"));break;case"AdSystem":a.system={value:E.parseNodeText(o),version:o.getAttribute("version")||null};break;case"AdTitle":a.title=E.parseNodeText(o);break;case"AdServingId":a.adServingId=E.parseNodeText(o);break;case"Category":a.categories.push({authority:o.getAttribute("authority")||null,value:E.parseNodeText(o)});break;case"Expires":a.expires=parseInt(E.parseNodeText(o),10);break;case"ViewableImpression":a.viewableImpression=j(o);break;case"Description":a.description=E.parseNodeText(o);break;case"Advertiser":a.advertiser={id:o.getAttribute("id")||null,value:E.parseNodeText(o)};break;case"Pricing":a.pricing={value:E.parseNodeText(o),model:o.getAttribute("model")||null,currency:o.getAttribute("currency")||null};break;case"Survey":a.survey=E.parseNodeText(o);break;case"BlockedAdCategories":a.blockedAdCategories.push({authority:o.getAttribute("authority")||null,value:E.parseNodeText(o)})}}return r.length&&(a.adVerifications=a.adVerifications.concat(r)),a}function F(e,t){var r=B(e,t),i=e.getAttribute("followAdditionalWrappers"),a=e.getAttribute("allowMultipleAds"),n=e.getAttribute("fallbackOnNoAd");r.followAdditionalWrappers=!i||E.parseBoolean(i),r.allowMultipleAds=!!a&&E.parseBoolean(a),r.fallbackOnNoAd=n?E.parseBoolean(n):null;var o=E.childByName(e,"VASTAdTagURI");if(o?r.nextWrapperURL=E.parseNodeText(o):(o=E.childByName(e,"VASTAdTagURL"))&&(r.nextWrapperURL=E.parseNodeText(E.childByName(o,"URL"))),r.creatives.forEach((function(e){if(-1!==["linear","nonlinear"].indexOf(e.type)){if(e.trackingEvents){r.trackingEvents||(r.trackingEvents={}),r.trackingEvents[e.type]||(r.trackingEvents[e.type]={});var t=function(t){var i=e.trackingEvents[t];Array.isArray(r.trackingEvents[e.type][t])||(r.trackingEvents[e.type][t]=[]),i.forEach((function(i){r.trackingEvents[e.type][t].push(i)}))};for(var i in e.trackingEvents)t(i)}e.videoClickTrackingURLTemplates&&(Array.isArray(r.videoClickTrackingURLTemplates)||(r.videoClickTrackingURLTemplates=[]),e.videoClickTrackingURLTemplates.forEach((function(e){r.videoClickTrackingURLTemplates.push(e)}))),e.videoClickThroughURLTemplate&&(r.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate),e.videoCustomClickURLTemplates&&(Array.isArray(r.videoCustomClickURLTemplates)||(r.videoCustomClickURLTemplates=[]),e.videoCustomClickURLTemplates.forEach((function(e){r.videoCustomClickURLTemplates.push(e)})))}})),r.nextWrapperURL)return r}function M(e){var t=[];return e.forEach((function(e){var r={resource:null,vendor:null,browserOptional:!1,apiFramework:null,type:null,parameters:null,trackingEvents:{}},i=e.childNodes;for(var a in E.assignAttributes(e.attributes,r),i){var n=i[a];switch(n.nodeName){case"JavaScriptResource":case"ExecutableResource":r.resource=E.parseNodeText(n),E.assignAttributes(n.attributes,r);break;case"VerificationParameters":r.parameters=E.parseNodeText(n)}}var o=E.childByName(e,"TrackingEvents");o&&E.childrenByName(o,"Tracking").forEach((function(e){var t=e.getAttribute("event"),i=E.parseNodeText(e);t&&i&&(Array.isArray(r.trackingEvents[t])||(r.trackingEvents[t]=[]),r.trackingEvents[t].push(i))})),t.push(r)})),t}function W(e){var t=null,r=[];return e.some((function(e){return t=E.childByName(e,"AdVerifications")})),t&&(r=M(E.childrenByName(t,"Verification"))),r}function j(e){var t={};t.id=e.getAttribute("id")||null;var r=e.childNodes;for(var i in r){var a=r[i],n=a.nodeName,o=E.parseNodeText(a);if(("Viewable"===n||"NotViewable"===n||"ViewUndetermined"===n)&&o){var s=n.toLowerCase();Array.isArray(t[s])||(t[s]=[]),t[s].push(o)}}return t}var q=function(){function e(){r(this,e),this._handlers=[]}return a(e,[{key:"on",value:function(e,r){if("function"!=typeof r)throw new TypeError("The handler argument must be of type Function. Received type ".concat(t(r)));if(!e)throw new TypeError("The event argument must be of type String. Received type ".concat(t(e)));return this._handlers.push({event:e,handler:r}),this}},{key:"once",value:function(e,t){return this.on(e,function(e,t,r){var i={fired:!1,wrapFn:void 0};function a(){i.fired||(e.off(t,i.wrapFn),i.fired=!0,r.bind(e).apply(void 0,arguments))}return i.wrapFn=a,a}(this,e,t))}},{key:"off",value:function(e,t){return this._handlers=this._handlers.filter((function(r){return r.event!==e||r.handler!==t})),this}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];var a=!1;return this._handlers.forEach((function(t){"*"===t.event&&(a=!0,t.handler.apply(t,[e].concat(r))),t.event===e&&(a=!0,t.handler.apply(t,r))})),a}},{key:"removeAllListeners",value:function(e){return e?(this._handlers=this._handlers.filter((function(t){return t.event!==e})),this):(this._handlers=[],this)}},{key:"listenerCount",value:function(e){return this._handlers.filter((function(t){return t.event===e})).length}},{key:"listeners",value:function(e){return this._handlers.reduce((function(t,r){return r.event===e&&t.push(r.handler),t}),[])}},{key:"eventNames",value:function(){return this._handlers.map((function(e){return e.event}))}}]),e}(),H=12e4;function Y(){try{var e=new window.XMLHttpRequest;return"withCredentials"in e?e:null}catch(e){return null}}function $(e,t,r){var i=r?408:e.status,a=r?"XHRURLHandler: Request timed out after ".concat(e.timeout," ms (").concat(i,")"):"XHRURLHandler: ".concat(e.statusText," (").concat(i,")");t(new Error(a),null,{statusCode:i})}var G={get:function(e,t,r){return r||("function"==typeof t&&(r=t),t={}),"undefined"==typeof window||null===window?function(e,t,r){r(new Error("Please bundle the library for node to use the node urlHandler"))}(0,0,r):Y()?function(e,t,r){if("https:"===window.location.protocol&&0===e.indexOf("http://"))return r(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{var i=Y();i.open("GET",e),i.timeout=t.timeout||H,i.withCredentials=t.withCredentials||!1,i.overrideMimeType&&i.overrideMimeType("text/xml"),i.onload=function(){return function(e,t){200===e.status?t(null,e.responseXML,{byteLength:e.response.length,statusCode:e.status}):$(e,t,!1)}(i,r)},i.onerror=function(){return $(i,r,!1)},i.onabort=function(){return $(i,r,!1)},i.ontimeout=function(){return $(i,r,!0)},i.send()}catch(e){r(new Error("XHRURLHandler: Unexpected error"))}}(e,t,r):r(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))}},z=0,X=0,K=function(e,t){!e||!t||e<=0||t<=0||(X=(X*z+8*e/t)/++z)},Q={ERRORCODE:900,extensions:[]},J=function(e){l(i,e);var t=d(i);function i(){var e;return r(this,i),(e=t.call(this)).remainingAds=[],e.parentURLs=[],e.errorURLTemplates=[],e.rootErrorURLTemplates=[],e.maxWrapperDepth=null,e.URLTemplateFilters=[],e.fetchingOptions={},e.parsingOptions={},e}return a(i,[{key:"addURLTemplateFilter",value:function(e){"function"==typeof e&&this.URLTemplateFilters.push(e)}},{key:"removeURLTemplateFilter",value:function(){this.URLTemplateFilters.pop()}},{key:"countURLTemplateFilters",value:function(){return this.URLTemplateFilters.length}},{key:"clearURLTemplateFilters",value:function(){this.URLTemplateFilters=[]}},{key:"trackVastError",value:function(e,t){for(var r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];this.emit("VAST-error",Object.assign.apply(Object,[{},Q,t].concat(i))),w.track(e,t)}},{key:"getErrorURLTemplates",value:function(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}},{key:"getEstimatedBitrate",value:function(){return X}},{key:"fetchVAST",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(a,n){t.URLTemplateFilters.forEach((function(t){e=t(e)})),t.parentURLs.push(e);var o=Date.now();t.emit("VAST-resolving",{url:e,previousUrl:i,wrapperDepth:r,maxWrapperDepth:t.maxWrapperDepth,timeout:t.fetchingOptions.timeout}),t.urlHandler.get(e,t.fetchingOptions,(function(s,l){var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=Math.round(Date.now()-o),d=Object.assign({url:e,previousUrl:i,wrapperDepth:r,error:s,duration:u},c);t.emit("VAST-resolved",d),K(c.byteLength,u),s?n(s):a(l)}))}))}},{key:"initParsingStatus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.errorURLTemplates=[],this.fetchingOptions={timeout:e.timeout||H,withCredentials:e.withCredentials},this.maxWrapperDepth=e.wrapperLimit||10,this.parentURLs=[],this.parsingOptions={allowMultipleAds:e.allowMultipleAds},this.remainingAds=[],this.rootErrorURLTemplates=[],this.rootURL="",this.urlHandler=e.urlHandler||e.urlhandler||G,this.vastVersion=null,K(e.byteLength,e.requestDuration)}},{key:"getRemainingAds",value:function(e){var t=this;if(0===this.remainingAds.length)return Promise.reject(new Error("No more ads are available for the given VAST"));var r=e?w.flatten(this.remainingAds):this.remainingAds.shift();return this.errorURLTemplates=[],this.parentURLs=[],this.resolveAds(r,{wrapperDepth:0,url:this.rootURL}).then((function(e){return t.buildVASTResponse(e)}))}},{key:"getAndParseVAST",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),this.URLTemplateFilters.forEach((function(t){e=t(e)})),this.rootURL=e,this.fetchVAST(e).then((function(i){return r.previousUrl=e,r.isRootVAST=!0,r.url=e,t.parse(i,r).then((function(e){return t.buildVASTResponse(e)}))}))}},{key:"parseVAST",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),r.isRootVAST=!0,this.parse(e,r).then((function(e){return t.buildVASTResponse(e)}))}},{key:"buildVASTResponse",value:function(e){var t,r={ads:(t={ads:e,errorURLTemplates:this.getErrorURLTemplates(),version:this.vastVersion}).ads||[],errorURLTemplates:t.errorURLTemplates||[],version:t.version||null};return this.completeWrapperResolving(r),r}},{key:"parseVastXml",value:function(e,t){var r=t.isRootVAST,i=void 0!==r&&r,a=t.url,n=void 0===a?null:a,o=t.wrapperDepth,s=void 0===o?0:o,l=t.allowMultipleAds,c=t.followAdditionalWrappers;if(!e||!e.documentElement||"VAST"!==e.documentElement.nodeName)throw this.emit("VAST-ad-parsed",{type:"ERROR",url:n,wrapperDepth:s}),new Error("Invalid VAST XMLDocument");var u=[],d=e.documentElement.childNodes,p=e.documentElement.getAttribute("version");for(var h in i&&p&&(this.vastVersion=p),d){var v=d[h];if("Error"===v.nodeName){var m=E.parseNodeText(v);i?this.rootErrorURLTemplates.push(m):this.errorURLTemplates.push(m)}else if("Ad"===v.nodeName){if(this.vastVersion&&parseFloat(this.vastVersion)<3)l=!0;else if(!1===l&&u.length>1)break;var f=V(v,this.emit.bind(this),{allowMultipleAds:l,followAdditionalWrappers:c});f.ad?(u.push(f.ad),this.emit("VAST-ad-parsed",{type:f.type,url:n,wrapperDepth:s,adIndex:u.length-1,vastVersion:p})):this.trackVastError(this.getErrorURLTemplates(),{ERRORCODE:101})}}return u}},{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.url,i=void 0===r?null:r,a=t.resolveAll,n=void 0===a||a,o=t.wrapperSequence,s=void 0===o?null:o,l=t.previousUrl,c=void 0===l?null:l,u=t.wrapperDepth,d=void 0===u?0:u,p=t.isRootVAST,h=void 0!==p&&p,v=t.followAdditionalWrappers,m=t.allowMultipleAds,f=[];this.vastVersion&&parseFloat(this.vastVersion)<3&&h&&(m=!0);try{f=this.parseVastXml(e,{isRootVAST:h,url:i,wrapperDepth:d,allowMultipleAds:m,followAdditionalWrappers:v})}catch(e){return Promise.reject(e)}return 1===f.length&&null!=s&&(f[0].sequence=s),!1===n&&(this.remainingAds=E.splitVAST(f),f=this.remainingAds.shift()),this.resolveAds(f,{wrapperDepth:d,previousUrl:c,url:i})}},{key:"resolveAds",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,i=r.wrapperDepth,a=r.previousUrl,n=r.url,o=[];return a=n,t.forEach((function(t){var r=e.resolveWrappers(t,i,a);o.push(r)})),Promise.all(o).then((function(t){var r=w.flatten(t);if(!r&&e.remainingAds.length>0){var o=e.remainingAds.shift();return e.resolveAds(o,{wrapperDepth:i,previousUrl:a,url:n})}return r}))}},{key:"resolveWrappers",value:function(e,t,r){var i=this;return new Promise((function(a){var n;if(t++,!e.nextWrapperURL)return delete e.nextWrapperURL,a(e);if(t>=i.maxWrapperDepth||-1!==i.parentURLs.indexOf(e.nextWrapperURL))return e.errorCode=302,delete e.nextWrapperURL,a(e);e.nextWrapperURL=E.resolveVastAdTagURI(e.nextWrapperURL,r),i.URLTemplateFilters.forEach((function(t){e.nextWrapperURL=t(e.nextWrapperURL)}));var o=null!==(n=i.parsingOptions.allowMultipleAds)&&void 0!==n?n:e.allowMultipleAds,s=e.sequence;i.fetchVAST(e.nextWrapperURL,t,r).then((function(n){return i.parse(n,{url:e.nextWrapperURL,previousUrl:r,wrapperSequence:s,wrapperDepth:t,followAdditionalWrappers:e.followAdditionalWrappers,allowMultipleAds:o}).then((function(t){if(delete e.nextWrapperURL,0===t.length)return e.creatives=[],a(e);t.forEach((function(t){t&&E.mergeWrapperAdData(t,e)})),a(t)}))})).catch((function(t){e.errorCode=301,e.errorMessage=t.message,a(e)}))}))}},{key:"completeWrapperResolving",value:function(e){if(0===e.ads.length)this.trackVastError(e.errorURLTemplates,{ERRORCODE:303});else for(var t=e.ads.length-1;t>=0;t--){var r=e.ads[t];(r.errorCode||0===r.creatives.length)&&(this.trackVastError(r.errorURLTemplates.concat(e.errorURLTemplates),{ERRORCODE:r.errorCode||303},{ERRORMESSAGE:r.errorMessage||""},{extensions:r.extensions},{system:r.system}),e.ads.splice(t,1))}}}]),i}(q),Z=null,ee={data:{},length:0,getItem:function(e){return this.data[e]},setItem:function(e,t){this.data[e]=t,this.length=Object.keys(this.data).length},removeItem:function(e){delete this.data[e],this.length=Object.keys(this.data).length},clear:function(){this.data={},this.length=0}},te=function(){function e(){r(this,e),this.storage=this.initStorage()}return a(e,[{key:"initStorage",value:function(){if(Z)return Z;try{Z="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){Z=null}return Z&&!this.isStorageDisabled(Z)||(Z=ee).clear(),Z}},{key:"isStorageDisabled",value:function(e){var t="__VASTStorage__";try{if(e.setItem(t,t),e.getItem(t)!==t)return e.removeItem(t),!0}catch(e){return!0}return e.removeItem(t),!1}},{key:"getItem",value:function(e){return this.storage.getItem(e)}},{key:"setItem",value:function(e,t){return this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){return this.storage.removeItem(e)}},{key:"clear",value:function(){return this.storage.clear()}}]),e}(),re=function(){function e(t,i,a){r(this,e),this.cappingFreeLunch=t||0,this.cappingMinimumTimeInterval=i||0,this.defaultOptions={withCredentials:!1,timeout:0},this.vastParser=new J,this.storage=a||new te,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}return a(e,[{key:"getParser",value:function(){return this.vastParser}},{key:"hasRemainingAds",value:function(){return this.vastParser.remainingAds.length>0}},{key:"getNextAds",value:function(e){return this.vastParser.getRemainingAds(e)}},{key:"get",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Date.now();return(r=Object.assign({},this.defaultOptions,r)).hasOwnProperty("resolveAll")||(r.resolveAll=!1),this.totalCallsTimeout<i?(this.totalCalls=1,this.totalCallsTimeout=i+36e5):this.totalCalls++,new Promise((function(a,n){if(t.cappingFreeLunch>=t.totalCalls)return n(new Error("VAST call canceled – FreeLunch capping not reached yet ".concat(t.totalCalls,"/").concat(t.cappingFreeLunch)));var o=i-t.lastSuccessfulAd;if(o<0)t.lastSuccessfulAd=0;else if(o<t.cappingMinimumTimeInterval)return n(new Error("VAST call canceled – (".concat(t.cappingMinimumTimeInterval,")ms minimum interval reached")));t.vastParser.getAndParseVAST(e,r).then((function(e){return a(e)})).catch((function(e){return n(e)}))}))}},{key:"lastSuccessfulAd",get:function(){return this.storage.getItem("vast-client-last-successful-ad")},set:function(e){this.storage.setItem("vast-client-last-successful-ad",e)}},{key:"totalCalls",get:function(){return this.storage.getItem("vast-client-total-calls")},set:function(e){this.storage.setItem("vast-client-total-calls",e)}},{key:"totalCallsTimeout",get:function(){return this.storage.getItem("vast-client-total-calls-timeout")},set:function(e){this.storage.setItem("vast-client-total-calls-timeout",e)}}]),e}(),ie=function(e){l(i,e);var t=d(i);function i(e,a,n){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;for(var l in r(this,i),(o=t.call(this)).ad=a,o.creative=n,o.variation=s,o.muted=!1,o.impressed=!1,o.skippable=!1,o.trackingEvents={},o.lastPercentage=0,o._alreadyTriggeredQuartiles={},o.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],o.creative.trackingEvents){var c=o.creative.trackingEvents[l];o.trackingEvents[l]=c.slice(0)}return function(e){return"linear"===e.type}(o.creative)?o._initLinearTracking():o._initVariationTracking(),e&&o.on("start",(function(){e.lastSuccessfulAd=Date.now()})),o}return a(i,[{key:"_initLinearTracking",value:function(){this.linear=!0,this.skipDelay=this.creative.skipDelay,this.setDuration(this.creative.duration),this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates}},{key:"_initVariationTracking",value:function(){if(this.linear=!1,this.skipDelay=-1,this.variation){for(var e in this.variation.trackingEvents){var t=this.variation.trackingEvents[e];this.trackingEvents[e]?this.trackingEvents[e]=this.trackingEvents[e].concat(t.slice(0)):this.trackingEvents[e]=t.slice(0)}"nonLinearAd"===this.variation.adType?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates,this.setDuration(this.variation.minSuggestedDuration)):function(e){return"companionAd"===e.adType}(this.variation)&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates)}}},{key:"setDuration",value:function(e){this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}}},{key:"setProgress",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.skipDelay||-1;if(-1===i||this.skippable||(i>e?this.emit("skip-countdown",i-e):(this.skippable=!0,this.emit("skip-countdown",0))),this.assetDuration>0){var a=Math.round(e/this.assetDuration*100),n=[];if(e>0){n.push("start");for(var o=this.lastPercentage;o<a;o++)n.push("progress-".concat(o+1,"%"));for(var s in n.push("progress-".concat(Math.round(e))),this.quartiles)this.isQuartileReached(s,this.quartiles[s],e)&&(n.push(s),this._alreadyTriggeredQuartiles[s]=!0);this.lastPercentage=a}n.forEach((function(e){t.track(e,{macros:r,once:!0})})),e<this.progress&&this.track("rewind",{macros:r})}this.progress=e}},{key:"isQuartileReached",value:function(e,t,r){var i=!1;return t<=r&&!this._alreadyTriggeredQuartiles[e]&&(i=!0),i}},{key:"setMuted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.muted!==e&&this.track(e?"mute":"unmute",{macros:t}),this.muted=e}},{key:"setPaused",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.paused!==e&&this.track(e?"pause":"resume",{macros:t}),this.paused=e}},{key:"setFullscreen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen",{macros:t}),this.fullscreen=e}},{key:"setExpand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.expanded!==e&&(this.track(e?"expand":"collapse",{macros:t}),this.track(e?"playerExpand":"playerCollapse",{macros:t})),this.expanded=e}},{key:"setSkipDelay",value:function(e){"number"==typeof e&&(this.skipDelay=e)}},{key:"trackImpression",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates,e),this.track("creativeView",{macros:e}))}},{key:"error",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.trackURLs(this.ad.errorURLTemplates,e,{isCustomCode:t})}},{key:"errorWithCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.error({ERRORCODE:e},t),console.log("The method errorWithCode is deprecated, please use vast tracker error method instead")}},{key:"complete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("complete",{macros:e})}},{key:"notUsed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("notUsed",{macros:e}),this.trackingEvents=[]}},{key:"otherAdInteraction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("otherAdInteraction",{macros:e})}},{key:"acceptInvitation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("acceptInvitation",{macros:e})}},{key:"adExpand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("adExpand",{macros:e})}},{key:"adCollapse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("adCollapse",{macros:e})}},{key:"minimize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("minimize",{macros:e})}},{key:"verificationNotExecuted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.ad||!this.ad.adVerifications||!this.ad.adVerifications.length)throw new Error("No adVerifications provided");if(!e)throw new Error("No vendor provided, unable to find associated verificationNotExecuted");var r=this.ad.adVerifications.find((function(t){return t.vendor===e}));if(!r)throw new Error("No associated verification element found for vendor: ".concat(e));var i=r.trackingEvents;if(i&&i.verificationNotExecuted){var a=i.verificationNotExecuted;this.trackURLs(a,t),this.emit("verificationNotExecuted",{trackingURLTemplates:a})}}},{key:"overlayViewDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.ADPLAYHEAD=e,this.track("overlayViewDuration",{macros:t})}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track(this.linear?"closeLinear":"close",{macros:e})}},{key:"skip",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("skip",{macros:e})}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.track("loaded",{macros:e})}},{key:"click",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates,t);var r=this.clickThroughURLTemplate||e,i=s({},t);if(r){this.progress&&(i.ADPLAYHEAD=this.progressFormatted());var a=w.resolveURLTemplates([r],i)[0];this.emit("clickthrough",a)}}},{key:"track",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.macros,i=void 0===r?{}:r,a=t.once,n=void 0!==a&&a;"closeLinear"===e&&!this.trackingEvents[e]&&this.trackingEvents.close&&(e="close");var o=this.trackingEvents[e],s=this.emitAlwaysEvents.indexOf(e)>-1;o?(this.emit(e,{trackingURLTemplates:o}),this.trackURLs(o,i)):s&&this.emit(e,null),n&&(delete this.trackingEvents[e],s&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(e),1))}},{key:"trackURLs",value:function(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=s({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(r.ASSETURI=this.creative.mediaFiles[0].fileURL),this.progress&&(r.ADPLAYHEAD=this.progressFormatted())),this.creative&&this.creative.universalAdId&&this.creative.universalAdId.idRegistry&&this.creative.universalAdId.value&&(r.UNIVERSALADID="".concat(this.creative.universalAdId.idRegistry," ").concat(this.creative.universalAdId.value)),this.ad&&(this.ad.sequence&&(r.PODSEQUENCE=this.ad.sequence),this.ad.adType&&(r.ADTYPE=this.ad.adType),this.ad.adServingId&&(r.ADSERVINGID=this.ad.adServingId),this.ad.categories&&this.ad.categories.length&&(r.ADCATEGORIES=this.ad.categories.map((function(e){return e.value})).join(",")),this.ad.blockedAdCategories&&this.ad.blockedAdCategories.length&&(r.BLOCKEDADCATEGORIES=this.ad.blockedAdCategories)),w.track(e,r,t)}},{key:"convertToTimecode",value:function(e){var t=1e3*e,r=Math.floor(t/36e5),i=Math.floor(t/6e4%60),a=Math.floor(t/1e3%60),n=Math.floor(t%1e3);return"".concat(w.leftpad(r,2),":").concat(w.leftpad(i,2),":").concat(w.leftpad(a,2),".").concat(w.leftpad(n,3))}},{key:"progressFormatted",value:function(){return this.convertToTimecode(this.progress)}}]),i}(q);return e.VASTClient=re,e.VASTParser=J,e.VASTTracker=ie,e}({});function create_vast_player_v2(e,t){var r=function(e){"second"==e?setCookie("preroll_skip","2",.4):"postroll"==e?setCookie("postroll_skip","1",.4):"adshare"!==e&&setCookie("preroll_skip","1",.5)};if(3==(t=void 0!==t?t:0))return r(e),!1;if(e){analytics_track_event("preroll_ad_epom","load",e);const a=getVastBaseUrl(!1,e,t),n=new URL(a);n.searchParams.append("cp.keywords",window.pg_page_metadata),addContentCreatorIdToIframeAd(n),"undefined"!=typeof ads_channel&&n.searchParams.append("ch",ads_channel),n.searchParams.append("o",window.pg_window_location),1==t&&n.searchParams.append("cp.sc_offset",1);var i=new VAST.VASTClient;i.get(n.href).then((n=>{const o=window.main_player?.paused();o||window.main_player.pause();var s=n.ads[0].creatives[0].mediaFiles[0],l=n.ads[0].creatives[0].videoClickThroughURLTemplate.url;const c=a.split("/"),u=c.length>0?`data-ad-key="${c.pop()}"`:"";$("#video_container").append(`<video class="video-js vjs-theme-sb" id="vast_video_player" data-testid="ad-video-player" ${u}></video>`),window.vast_v2_player=videojs("vast_video_player",{controls:!1,autoplay:!$("#player_wrapper_outer .play_cover").is(":visible"),preload:"metadata",playsinline:!0,html5:{nativeAudioTracks:videojs.browser.IS_ANY_SAFARI,nativeVideoTracks:videojs.browser.IS_ANY_SAFARI,vhs:{overrideNative:!videojs.browser.IS_ANY_SAFARI,useBandwidthFromLocalStorage:!0,smoothQualityChange:!1,limitRenditionByPlayerDimensions:!0,useDevicePixelRatio:!0}}},(function(){var a=this;a.volume(.25),a.src({src:s.fileURL,type:s.mimeType}),a.one("error",(function(){err=a.error(),a.dispose(),window.main_player.play(),analytics_track_event("preroll_ad_epom","error_play",e+"||"+t+"||"+err.message),create_vast_player_v2(e,t+1)})),window.vastTracker=new VAST.VASTTracker(i,n.ads[0],n.ads[0].creatives[0]),vastTracker.setSkipDelay(5),vastTracker.load(),a.one("play",(function(){0==vastTracker.assetDuration&&vastTracker.setDuration(Math.floor(a.duration())),vastTracker.assetDuration>30&&vastTracker.setDuration(30),vastTracker.trackImpression(),analytics_track_event("preroll_ad_epom","started",e);var t=0;window.timer_end_vast_timeout&&clearTimeout(window.timer_end_vast_timeout),window.timer_vast_interval&&clearInterval(window.timer_vast_interval),window.timer_vast_interval=setInterval((function(){vastTracker.setProgress(t),t+=.5}),500),window.timer_end_vast_timeout=setTimeout((function(){o()}),35e3)}));var o=function(){a.dispose(),window.main_player.play(),vastTracker.complete(),analytics_track_event("preroll_ad_epom","finished",e),window.timer_end_vast_timeout&&clearTimeout(window.timer_end_vast_timeout),window.timer_vast_interval&&clearInterval(window.timer_vast_interval),r(e)};a.one("ended",(function(){o()})),$("#vast_video_player").append('<span class="vast_skip_button">Skip Ad in <em>5</em></span>');var c=$("#vast_video_player").find(".vast_skip_button"),u=$("#vast_video_player").find(".vast_skip_button em");vastTracker.on("skip-countdown",(function(t){(t=Math.ceil(t))!=u.text()&&(u.text(t),0==t&&(c.html("Skip Ad <em>&#10095;&#10095;</em>"),c.on("click",(function(t){t.stopImmediatePropagation(),t.preventDefault(),a.dispose(),window.main_player.play(),vastTracker.skip(),vastTracker.complete(),analytics_track_event("preroll_ad_epom","skipped",e),window.timer_end_vast_timeout&&clearTimeout(window.timer_end_vast_timeout),window.timer_vast_interval&&clearInterval(window.timer_vast_interval),r(e)})).addClass("vast_skip_button_active")))})),$("#vast_video_player").append('<span class="vast_ad_icon"> '+svg_icon("ad")+" </span>"),$("#vast_video_player").append('<span class="vast_ad_title">Check It Out</span>');var d=n.ads[0].title;-1!=d.toLowerCase().search(/spankbang\.xxx/)?($("#vast_video_player .vast_ad_title").text(d.replace("spankbang.xxx ","")),$("#vast_video_player .vast_ad_title").prepend(svg_icon("heart")+" "),$("#vast_video_player .vast_ad_title").append(" "+svg_icon("heart"))):d&&d.split(" ").length>3&&-1==d.toLowerCase().search(/vast|phn|tag|ad|postgen|exo|ts|traffic/)&&$("#vast_video_player .vast_ad_title").text(d),$("#vast_video_player .vast_ad_title").prepend(svg_icon("ad")+" "),$("#vast_video_player .vast_ad_title").append(" "+svg_icon("external-link-square-alt"));var p=function(){a.pause(),window.open(l,"_blank","noopener"),vastTracker.click(),analytics_track_event("preroll_ad_epom","clicked",e),r(e)};$("#vast_video_player_html5_api").one("click",(function(e){p()})),$("#vast_video_player .vast_ad_title").one("click",(function(e){p()})).css({cursor:"pointer"})}))})).catch((r=>{analytics_track_event("preroll_ad_epom","error_init",e+"||"+t+"||"+r.toString()),create_vast_player_v2(e,t+1)}))}}void 0===window.pg_window_location&&(window.pg_window_location="https://spankbang.com"+window.location.pathname),void 0===window.pg_page_metadata&&("undefined"!=typeof page_matadata&&page_matadata instanceof Array?window.pg_page_metadata=encodeURIComponent(page_matadata.join(",").toLowerCase()):window.pg_page_metadata="null");